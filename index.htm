<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Anomalias</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5; margin: 0; padding: 20px; color: #333; }
        
        /* LOGIN */
        #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .login-box { background: white; padding: 40px; border-radius: 12px; width: 350px; box-shadow: 0 15px 35px rgba(0,0,0,0.5); text-align: center; }
        .login-input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; }
        .login-btn { width: 100%; padding: 12px; background: #0056b3; color: white; border: none; border-radius: 6px; font-size: 16px; cursor: pointer; font-weight: bold; }
        .login-btn:hover { background: #004494; }

        /* MODAL */
        #detalhesModal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); backdrop-filter: blur(3px); }
        .modal-content { background-color: #fff; margin: 5% auto; padding: 25px; border-radius: 10px; width: 85%; max-width: 950px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .close-btn { float: right; font-size: 28px; font-weight: bold; cursor: pointer; color: #aaa; }
        .close-btn:hover { color: #333; }

        /* LAYOUT */
        .header { background: #fff; padding: 20px 30px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border-left: 5px solid #0056b3; }
        .header h1 { margin: 0; font-size: 24px; color: #004085; }
        
        .kpi-container { display: flex; gap: 20px; margin-bottom: 30px; flex-wrap: wrap; }
        .kpi-card { flex: 1; min-width: 200px; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); border-left: 5px solid #ccc; }
        .kpi-card h3 { margin: 0 0 10px; font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 1px; }
        .kpi-card .value { font-size: 38px; font-weight: 700; color: #333; }
        .kpi-blue { border-color: #007bff; } .kpi-red { border-color: #dc3545; } .kpi-orange { border-color: #fd7e14; } .kpi-green { border-color: #28a745; }

        .table-container { background: #fff; padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); overflow-x: auto; }
        table { width: 100%; border-collapse: separate; border-spacing: 0; min-width: 800px; }
        th { padding: 15px; text-align: left; background: #f8f9fa; color: #555; font-weight: 700; border-bottom: 2px solid #e9ecef; cursor: pointer; }
        td { padding: 12px 15px; border-bottom: 1px solid #f1f1f1; font-size: 14px; }
        .badge { padding: 5px 12px; border-radius: 20px; font-size: 11px; font-weight: bold; color: #fff; display: inline-block; min-width: 80px; text-align: center; }
        
        .bg-pendente { background-color: #dc3545; }
        .bg-atrasado { background-color: #fd7e14; }
        .bg-concluido { background-color: #28a745; }
        
        .tabela-detalhe { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .tabela-detalhe th { background: #0056b3; color: white; padding: 10px; font-size: 13px; }
        .tabela-detalhe td { border: 1px solid #dee2e6; padding: 10px; font-size: 13px; vertical-align: top; }
        .tabela-detalhe tr:nth-child(even) { background-color: #f8f9fa; }
        
        .cat-tag { background: #e9ecef; color: #495057; padding: 3px 8px; border-radius: 4px; font-weight: bold; font-size: 12px; display: inline-block; margin-bottom: 4px; }
    </style>
</head>
<body>

    <div id="loginOverlay">
        <div class="login-box">
            <h2 style="color: #004085;">Triunfante</h2>
            <p style="color: #666; margin-bottom: 20px;">Acesso Executivo</p>
            <input type="text" id="user" class="login-input" placeholder="Usu√°rio" onkeypress="handleEnter(event)">
            <input type="password" id="pass" class="login-input" placeholder="Senha" onkeypress="handleEnter(event)">
            <button class="login-btn" onclick="fazerLogin()">Entrar</button>
            <p id="errorMsg" style="color: red; font-size: 13px; margin-top: 10px; display: none;">Dados incorretos.</p>
        </div>
    </div>

    <div id="detalhesModal">
        <div class="modal-content">
            <span class="close-btn" onclick="fecharModal()">&times;</span>
            <h2 id="modalTitulo" style="color: #004085; margin: 0 0 5px 0;">Detalhes</h2>
            <p id="modalSubtitulo" style="color: #666; margin: 0 0 20px 0;"></p>
            <div style="overflow-x: auto;">
                <table class="tabela-detalhe">
                    <thead>
                        <tr>
                            <th width="15%">Data</th>
                            <th width="10%">Status</th>
                            <th width="30%">Motivo (Auto)</th>
                            <th width="45%">Descri√ß√£o Original</th>
                        </tr>
                    </thead>
                    <tbody id="modalCorpo"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="dashboardContainer" style="display: none;">
        <div class="header">
            <div><h1>Dashboard de Anomalias</h1><small style="color: #666;">Monitoramento e Tratativas</small></div>
            <div style="display: flex; gap: 10px; align-items: center;">
                <span id="userBadge" style="background: #e9ecef; padding: 5px 10px; border-radius: 4px; font-weight: bold; color: #555;"></span>
                <button onclick="logout()" style="padding: 8px 15px; border: 1px solid #ccc; background: white; border-radius: 4px; cursor: pointer;">Sair</button>
            </div>
        </div>

        <div class="kpi-container">
            <div class="kpi-card kpi-blue"><h3>Total Geral</h3><div class="value" id="kpiTotal">0</div></div>
            <div class="kpi-card kpi-red"><h3>Pendentes</h3><div class="value" id="kpiPendente">0</div></div>
            <div class="kpi-card kpi-orange"><h3>Atrasados</h3><div class="value" id="kpiAtrasado">0</div></div>
            <div class="kpi-card kpi-green"><h3>Conclu√≠dos</h3><div class="value" id="kpiConcluido">0</div></div>
        </div>

        <div class="charts-row" style="display: flex; gap: 20px; flex-wrap: wrap;">
            <div class="table-container" style="flex: 1; min-width: 300px; height: 350px;"><canvas id="chartStatus"></canvas></div>
            <div class="table-container" style="flex: 1; min-width: 300px; height: 350px;"><canvas id="chartResponsavel"></canvas></div>
        </div>

        <div class="table-container">
            <h3 style="margin-top: 0; color: #444;">üìã Vis√£o Detalhada por Respons√°vel</h3>
            <p style="font-size: 13px; color: #888;">*Clique no nome para ver a classifica√ß√£o autom√°tica das anomalias.</p>
            <table>
                <thead>
                    <tr>
                        <th onclick="ordenar('filial')">Filial ‚Üï</th>
                        <th onclick="ordenar('responsavel')">Respons√°vel ‚Üï</th>
                        <th onclick="ordenar('anomalias')" style="text-align: center;">Qtd ‚Üï</th>
                        <th onclick="ordenar('planos')" style="text-align: center;">Planos ‚Üï</th>
                        <th onclick="ordenar('status')" style="text-align: center;">Status Geral ‚Üï</th>
                        <th>A√ß√£o</th>
                    </tr>
                </thead>
                <tbody id="tabelaCorpo"></tbody>
            </table>
        </div>
    </div>

    <script>
        // =================================================================
        // PARTE 2: DADOS COMPLETOS (COPIAR E COLAR NO LUGAR DA CONSTANTE)
        // =================================================================
        
        const dadosBanco = [
            {"filial": "ABC", "responsavel": "Missaid Mainardes", "anomalias": 1, "planos": 0, "status": "Pendente", "diretoria": "Comercial", "detalhes": [{"data": "2025-11-12", "cat": "Devolu√ß√£o", "desc": "Unidade ABC apresentou R$ 1.050.735,23 em devolu√ß√µes...", "status": "Pendente"}]},
            {"filial": "ABC", "responsavel": "Nei Lessak", "anomalias": 3, "planos": 2, "status": "Pendente", "diretoria": "Logistica", "detalhes": [{"data": "2025-11-11", "cat": "Avaria", "desc": "BAIXA DE ESTOQUE POR AVARIA - REG-62208-543...", "status": "Conclu√≠do"}, {"data": "2025-11-11", "cat": "Avaria", "desc": "BAIXA DE ESTOQUE POR AVARIA - REG-19233-716...", "status": "Conclu√≠do"}, {"data": "2025-11-24", "cat": "Avaria", "desc": "ANOMALIA de AVARIAS, em 13NOV25, totalizou R$ 547,27...", "status": "Pendente"}]},
            {"filial": "API", "responsavel": "Arildo Zago", "anomalias": 1, "planos": 0, "status": "Pendente", "diretoria": "Comercial", "detalhes": [{"data": "2025-11-13", "cat": "Devolu√ß√£o", "desc": "Unidade API apresentou R$ 1.314.189,82 em devolu√ß√µes...", "status": "Pendente"}]},
            {"filial": "API", "responsavel": "Magno Souza", "anomalias": 1, "planos": 1, "status": "Conclu√≠do", "diretoria": "Logistica", "detalhes": [{"data": "2025-11-13", "cat": "Devolu√ß√£o", "desc": "Unidade API apresentou total de R$ 1.314.189,82 em devolu√ß√µes...", "status": "Conclu√≠do"}]},
            {"filial": "API", "responsavel": "Marcos Nichelle", "anomalias": 2, "planos": 1, "status": "Atrasado", "diretoria": "Comercial", "detalhes": [{"data": "2025-11-12", "cat": "Vencimento/FEFO", "desc": "Produtos vencidos que estavam sendo sinalizados com anteced√™ncia...", "status": "Atrasado"}, {"data": "2025-11-19", "cat": "Vencimento/FEFO", "desc": "Elaborar plano de a√ß√£o para redu√ß√£o de vencidos...", "status": "Pendente"}]},
            {"filial": "API", "responsavel": "Ronaldo Crispim", "anomalias": 2, "planos": 0, "status": "Pendente", "diretoria": "Logistica", "detalhes": [{"data": "2025-10-31", "cat": "Diverg√™ncia/Estoque", "desc": "Ajustes de estoques constatados no inventario parcial...", "status": "Pendente"}, {"data": "2025-11-11", "cat": "Diverg√™ncia/Estoque", "desc": "Solicita√ß√£o de baixa de estoque, requer plano de a√ß√£o...", "status": "Pendente"}]},
            {"filial": "MCD", "responsavel": "Ademir Lobato", "anomalias": 1, "planos": 0, "status": "Pendente", "diretoria": "Logistica", "detalhes": [{"data": "2025-11-11", "cat": "Outros", "desc": "O local apresenta uma grande quantidade de fezes de roedores...", "status": "Pendente"}]},
            {"filial": "MCD", "responsavel": "Cleverson Kuba", "anomalias": 6, "planos": 0, "status": "Pendente", "diretoria": "Comercial", "detalhes": [{"data": "2025-11-04", "cat": "Vencimento/FEFO", "desc": "Produtos topei pacoca vencidos no estoque...", "status": "Pendente"}, {"data": "2025-11-06", "cat": "Vencimento/FEFO", "desc": "Produtos vencidos no estoque por gentileza realizar processo de baixa...", "status": "Pendente"}, {"data": "2025-11-13", "cat": "Vencimento/FEFO", "desc": "Solicito por gentileza a baixa do iterm...", "status": "Pendente"}, {"data": "2025-11-14", "cat": "Devolu√ß√£o", "desc": "DANFE de devolu√ß√£o sem senha...", "status": "Pendente"}, {"data": "2025-11-14", "cat": "Devolu√ß√£o", "desc": "Danfe de devolu√ß√£o sem a senha de devolu√ß√£o...", "status": "Pendente"}, {"data": "2025-11-17", "cat": "Vencimento/FEFO", "desc": "Produto vencido no estoque...", "status": "Pendente"}]},
            {"filial": "MCD", "responsavel": "Emanuel Boscolo", "anomalias": 1, "planos": 0, "status": "Conclu√≠do", "diretoria": "Financeiro", "detalhes": [{"data": "2025-11-05", "cat": "Fiscal/Financeiro", "desc": "Pagamento DUCOCO ALIMENTOS SA, NF 187...", "status": "Conclu√≠do"}]},
            {"filial": "MCD", "responsavel": "Fabio Rogerio", "anomalias": 1, "planos": 0, "status": "Pendente", "diretoria": "Comercial", "detalhes": [{"data": "2025-11-13", "cat": "Devolu√ß√£o", "desc": "Unidade MCD apresentou R$ 4.221.881,60 em devolu√ß√µes...", "status": "Pendente"}]},
            {"filial": "MCD", "responsavel": "Jose Oscar", "anomalias": 15, "planos": 0, "status": "Pendente", "diretoria": "Logistica", "detalhes": [{"data": "2025-11-11", "cat": "Outros", "desc": "Encontrado roedor na carga...", "status": "Pendente"}, {"data": "2025-11-11", "cat": "Outros", "desc": "Encontrado na rua k posi√ß√£o k005 um roedor esmagado...", "status": "Pendente"}, {"data": "2025-11-11", "cat": "Outros", "desc": "Presen√ßa do item colgate prote√ß√£o ativa misturados...", "status": "Pendente"}, {"data": "2025-11-11", "cat": "Outros", "desc": "Restos de equipe descartado em local impr√≥prio...", "status": "Pendente"}, {"data": "2025-11-11", "cat": "Avaria", "desc": "Produtos fracionados fora do padrao de organiza√ß√£o...", "status": "Pendente"}, {"data": "2025-11-11", "cat": "Diverg√™ncia/Estoque", "desc": "Produto desorganizado no pick fora de padr√£o...", "status": "Pendente"}, {"data": "2025-11-11", "cat": "Avaria", "desc": "Palet ra√ß√£o no a√©reo risco de queda...", "status": "Pendente"}, {"data": "2025-11-11", "cat": "Avaria", "desc": "Avaria colgate com outros itens em bom estado...", "status": "Pendente"}, {"data": "2025-11-11", "cat": "Avaria", "desc": "Avarias no ch√£o em v√°rias ruas de Mcd...", "status": "Pendente"}, {"data": "2025-11-11", "cat": "Outros", "desc": "Placas de identifica√ß√£o de rua no ch√£o...", "status": "Pendente"}, {"data": "2025-11-11", "cat": "Avaria", "desc": "Avarias por consumo indevido biscoito e batatas...", "status": "Pendente"}, {"data": "2025-11-11", "cat": "Avaria", "desc": "Lixo e sujeira junto com produtos fracionados...", "status": "Pendente"}, {"data": "2025-11-11", "cat": "Avaria", "desc": "Fezes de roedores, produtos avariado...", "status": "Pendente"}, {"data": "2025-11-16", "cat": "Avaria", "desc": "Posi√ß√µes com risco de queda de produtos...", "status": "Pendente"}, {"data": "2025-11-17", "cat": "Avaria", "desc": "Sabonetes na rua N posi√ß√£o 57.0 molhando gerando avaria...", "status": "Pendente"}]},
            {"filial": "MCD", "responsavel": "Magno Souza", "anomalias": 1, "planos": 2, "status": "Em Dia", "diretoria": "Logistica", "detalhes": [{"data": "2025-11-13", "cat": "Devolu√ß√£o", "desc": "Unidade MCD apresentou um total de R$ 4.221.881,60 em devolu√ß√µes...", "status": "Em Dia"}]},
            {"filial": "TBE", "responsavel": "Jonas Portela", "anomalias": 1, "planos": 2, "status": "Em Dia", "diretoria": "Logistica", "detalhes": [{"data": "2025-11-12", "cat": "Outros", "desc": "Sa√≠das de Emerg√™ncia - Solicitado Lacres...", "status": "Em Dia"}]},
            {"filial": "TBE", "responsavel": "Kelly Pereira", "anomalias": 1, "planos": 1, "status": "Conclu√≠do", "diretoria": "Gente", "detalhes": [{"data": "2025-10-30", "cat": "Outros", "desc": "Solicitando ao time de Gente e Gest√£o a lista de f√©rias...", "status": "Conclu√≠do"}]},
            {"filial": "TBE", "responsavel": "Luis Fernando Feijo Ramos Junior", "anomalias": 2, "planos": 0, "status": "Pendente", "diretoria": "Comercial", "detalhes": [{"data": "2025-11-12", "cat": "Devolu√ß√£o", "desc": "Unidade TBA apresentou R$ 830.282,30 em devolu√ß√µes...", "status": "Pendente"}, {"data": "2025-11-13", "cat": "Devolu√ß√£o", "desc": "Unidade TBE apresentou R$ 153.633,65 em devolu√ß√µes...", "status": "Pendente"}]},
            {"filial": "TBE", "responsavel": "Patricia Aline Sa Silva", "anomalias": 2, "planos": 3, "status": "Atrasado", "diretoria": "Financeiro", "detalhes": [{"data": "2025-10-30", "cat": "Fiscal/Financeiro", "desc": "Acordos comerciais em TPA n√£o inclu√≠dos no contas a pagar...", "status": "Atrasado"}, {"data": "2025-11-10", "cat": "Fiscal/Financeiro", "desc": "Diverg√™ncias nos pagamentos de TPA...", "status": "Atrasado"}]},
            {"filial": "TBE", "responsavel": "Paulo Cholet", "anomalias": 1, "planos": 0, "status": "Pendente", "diretoria": "Comercial", "detalhes": [{"data": "2025-11-12", "cat": "Devolu√ß√£o", "desc": "Unidade TPA apresentou R$ 1.962.383,11 em devolu√ß√µes...", "status": "Pendente"}]},
            {"filial": "TBL", "responsavel": "Edson Bragato", "anomalias": 4, "planos": 2, "status": "Atrasado", "diretoria": "Logistica", "detalhes": [{"data": "2025-11-10", "cat": "Avaria", "desc": "Avaria no ato da entrega, chocolate derretido...", "status": "Atrasado"}, {"data": "2025-11-11", "cat": "Avaria", "desc": "Rondas de 5s em todos os corredores, constatados produtos...", "status": "Atrasado"}, {"data": "2025-11-19", "cat": "Vencimento/FEFO", "desc": "Produtos Vencidos no estoque FEFO...", "status": "Pendente"}, {"data": "2025-11-19", "cat": "Avaria", "desc": "Produtos com riscos de avarias fora das caixas...", "status": "Pendente"}]},
            {"filial": "TBL", "responsavel": "Everton Silva", "anomalias": 1, "planos": 0, "status": "Pendente", "diretoria": "Comercial", "detalhes": [{"data": "2025-11-12", "cat": "Devolu√ß√£o", "desc": "Unidade TBL apresentou R$ 985.792,13 em devolu√ß√µes...", "status": "Pendente"}]},
            {"filial": "TBL", "responsavel": "Idin√©ia Leite", "anomalias": 1, "planos": 3, "status": "Conclu√≠do", "diretoria": "Financeiro", "detalhes": [{"data": "2025-11-10", "cat": "Diverg√™ncia/Estoque", "desc": "Desvio no processo de solicita√ß√£o de baixa de estoque...", "status": "Conclu√≠do"}]},
            {"filial": "TBL", "responsavel": "Lucas Santana", "anomalias": 7, "planos": 0, "status": "Pendente", "diretoria": "Comercial", "detalhes": [{"data": "2025-10-29", "cat": "Vencimento/FEFO", "desc": "Cliente: Casa Vila Real - Produtos fora do prazo...", "status": "Pendente"}, {"data": "2025-10-29", "cat": "Vencimento/FEFO", "desc": "Cliente: Casa Vila Real - Produtos fora do prazo...", "status": "Pendente"}, {"data": "2025-10-30", "cat": "Vencimento/FEFO", "desc": "Cliente: Molins Supermercados - Produtos fora do prazo...", "status": "Pendente"}, {"data": "2025-10-30", "cat": "Diverg√™ncia/Estoque", "desc": "Cliente: Molins Supermercados - Produtos faltantes no fisico...", "status": "Pendente"}, {"data": "2025-10-30", "cat": "Vencimento/FEFO", "desc": "Cliente: M L Xavier - Produtos fora do prazo...", "status": "Pendente"}, {"data": "2025-10-30", "cat": "Vencimento/FEFO", "desc": "Cliente: C R V Estero - Produtos fora do prazo...", "status": "Pendente"}, {"data": "2025-10-30", "cat": "Vencimento/FEFO", "desc": "Cliente: Casa Vila Real - Produtos fora do prazo...", "status": "Pendente"}]},
            {"filial": "TBL", "responsavel": "Weverton Peixoto", "anomalias": 1, "planos": 0, "status": "Pendente", "diretoria": "Logistica", "detalhes": [{"data": "2025-11-06", "cat": "Outros", "desc": "Mau procedimento do colaborador La√©rcio (log√≠stica)...", "status": "Pendente"}]},
            {"filial": "TCA", "responsavel": "Becher Barros", "anomalias": 21, "planos": 0, "status": "Pendente", "diretoria": "Comercial", "detalhes": [{"data": "2025-11-03", "cat": "Vencimento/FEFO", "desc": "NF DE TROCA COM FALTA DE PRODUTOS E FORA DO PADR√ÉO...", "status": "Pendente"}, {"data": "2025-11-03", "cat": "Diverg√™ncia/Estoque", "desc": "NF DE TROCA N 15116 COM DIVERG√äNCIA...", "status": "Pendente"}, {"data": "2025-11-03", "cat": "Diverg√™ncia/Estoque", "desc": "NF DE TROCA N 15116 COM DIVERG√äNCIA...", "status": "Pendente"}, {"data": "2025-11-03", "cat": "Diverg√™ncia/Estoque", "desc": "NF DE TROCA N 2662 COM DIVERG√äNCIA...", "status": "Pendente"}, {"data": "2025-11-03", "cat": "Diverg√™ncia/Estoque", "desc": "NF DE TROCA N 2661 COM DIVERG√äNCIA...", "status": "Pendente"}, {"data": "2025-11-03", "cat": "Diverg√™ncia/Estoque", "desc": "NFS DE TROCA N 40525 A 40531 COM DIVERG√äNCIAS...", "status": "Pendente"}, {"data": "2025-11-07", "cat": "Diverg√™ncia/Estoque", "desc": "NF DE TROCA FORA DO PADR√ÉO, FALTA PRODUTOS...", "status": "Pendente"}, {"data": "2025-11-12", "cat": "Vencimento/FEFO", "desc": "NF 8352 - Fora do padr√£o +60 dias...", "status": "Pendente"}, {"data": "2025-11-12", "cat": "Diverg√™ncia/Estoque", "desc": "NF 1177 - Falta de produtos...", "status": "Pendente"}, {"data": "2025-11-12", "cat": "Vencimento/FEFO", "desc": "NF 8769 - Fora do prazo +60 dias...", "status": "Pendente"}, {"data": "2025-11-12", "cat": "Vencimento/FEFO", "desc": "NF 39717 - Fora do prazo +60 dias...", "status": "Pendente"}, {"data": "2025-11-12", "cat": "Vencimento/FEFO", "desc": "NF 39716 - Fora do prazo +60 dias...", "status": "Pendente"}, {"data": "2025-11-12", "cat": "Vencimento/FEFO", "desc": "NF 39719 - Fora do prazo +60 dias...", "status": "Pendente"}, {"data": "2025-11-12", "cat": "Vencimento/FEFO", "desc": "NF 39718 - Fora do prazo +60 dias...", "status": "Pendente"}, {"data": "2025-11-12", "cat": "Vencimento/FEFO", "desc": "NF 8766 - Fora do prazo +60 dias...", "status": "Pendente"}, {"data": "2025-11-12", "cat": "Vencimento/FEFO", "desc": "NF 24348 - Fora do padr√£o - faltas...", "status": "Pendente"}, {"data": "2025-11-12", "cat": "Vencimento/FEFO", "desc": "NF 310 - Fora do padr√£o - faltas...", "status": "Pendente"}, {"data": "2025-11-12", "cat": "Vencimento/FEFO", "desc": "NF 16263 - Fora do prazo +60 dias...", "status": "Pendente"}, {"data": "2025-11-12", "cat": "Vencimento/FEFO", "desc": "NF 66 - Fora do prazo +60 dias...", "status": "Pendente"}, {"data": "2025-11-21", "cat": "Vencimento/FEFO", "desc": "NF 123692 - Validade fora do padr√£o 2023/2024...", "status": "Pendente"}, {"data": "2025-11-21", "cat": "Vencimento/FEFO", "desc": "NF 123694 - Validade fora do padr√£o 2023/2024...", "status": "Pendente"}]},
            {"filial": "TCA", "responsavel": "Jos√© Lima", "anomalias": 14, "planos": 9, "status": "Atrasado", "diretoria": "Logistica", "detalhes": [{"data": "2025-10-30", "cat": "Vencimento/FEFO", "desc": "Produtos vencidos ainda presentes no pick...", "status": "Atrasado"}, {"data": "2025-10-30", "cat": "Vencimento/FEFO", "desc": "PRODUTO VENCIDO PRESENTE NO PICK...", "status": "Pendente"}, {"data": "2025-11-03", "cat": "Devolu√ß√£o", "desc": "Processo de confer√™ncia interrompido...", "status": "Atrasado"}, {"data": "2025-11-03", "cat": "Outros", "desc": "Refrigerador com defeito, n√£o faz degelo...", "status": "Atrasado"}, {"data": "2025-11-03", "cat": "Diverg√™ncia/Estoque", "desc": "Falta de organiza√ß√£o de picking...", "status": "Atrasado"}, {"data": "2025-11-03", "cat": "Diverg√™ncia/Estoque", "desc": "Produtos em caixa no ch√£o...", "status": "Conclu√≠do"}, {"data": "2025-11-03", "cat": "Avaria", "desc": "Paletes mal posicionados e sem strech no a√©reo...", "status": "Atrasado"}, {"data": "2025-11-03", "cat": "Devolu√ß√£o", "desc": "Demora na aloca√ß√£o de produtos...", "status": "Atrasado"}, {"data": "2025-11-07", "cat": "Avaria", "desc": "Avarias deixadas em local inapropriado...", "status": "Atrasado"}, {"data": "2025-11-11", "cat": "Diverg√™ncia/Estoque", "desc": "PRODUTOS FORA DAS CAIXAS...", "status": "Pendente"}, {"data": "2025-11-11", "cat": "Diverg√™ncia/Estoque", "desc": "PRODUTOS FORA DAS CAIXAS...", "status": "Pendente"}, {"data": "2025-11-11", "cat": "Diverg√™ncia/Estoque", "desc": "PRODUTOS FORA DAS CAIXAS...", "status": "Pendente"}, {"data": "2025-11-19", "cat": "Diverg√™ncia/Estoque", "desc": "Produto deixado no ch√£o...", "status": "Pendente"}, {"data": "2025-11-19", "cat": "Outros", "desc": "L√¢mpadas queimadas presentes em todas as docas...", "status": "Pendente"}]},
            {"filial": "TCA", "responsavel": "Yasmin Silva", "anomalias": 1, "planos": 0, "status": "Pendente", "diretoria": "Comercial", "detalhes": [{"data": "2025-11-13", "cat": "Devolu√ß√£o", "desc": "Unidade TCA apresentou R$ 1.731.923,40 em devolu√ß√µes...", "status": "Pendente"}]},
            {"filial": "TCG", "responsavel": "Cleverson Kuba", "anomalias": 26, "planos": 2, "status": "Pendente", "diretoria": "Comercial", "detalhes": [{"data": "2025-10-30", "cat": "Devolu√ß√£o", "desc": "Notas de devolu√ß√£o sem pedido do cliente...", "status": "Conclu√≠do"}, {"data": "2025-10-30", "cat": "Devolu√ß√£o", "desc": "Notas de devolu√ß√£o sem senha...", "status": "Conclu√≠do"}, {"data": "2025-10-31", "cat": "Avaria", "desc": "CONSUMO INDEVIDO E MANUSEIO INCORRETO...", "status": "Pendente"}, {"data": "2025-10-31", "cat": "Vencimento/FEFO", "desc": "SOLICITA√á√ÉO DE BAIXA - PRODUTO VENCIDO NO ESTOQUE...", "status": "Pendente"}, {"data": "2025-10-31", "cat": "Vencimento/FEFO", "desc": "Data da Solicita√ß√£o: 2025-10-29 - PRODUTO VENCIDO...", "status": "Pendente"}, {"data": "2025-11-03", "cat": "Devolu√ß√£o", "desc": "Nota de devolu√ß√£o onde o cliente n√£o solicitou...", "status": "Pendente"}, {"data": "2025-11-03", "cat": "Fiscal/Financeiro", "desc": "Notas sem senha...", "status": "Pendente"}, {"data": "2025-11-03", "cat": "Fiscal/Financeiro", "desc": "Notas sem senha...", "status": "Pendente"}, {"data": "2025-11-04", "cat": "Vencimento/FEFO", "desc": "Solicita√ß√£o de baixa referente a vencimento - Yokitos...", "status": "Pendente"}, {"data": "2025-11-05", "cat": "Fiscal/Financeiro", "desc": "Notas sem senha - Motorista informa...", "status": "Pendente"}, {"data": "2025-11-06", "cat": "Vencimento/FEFO", "desc": "Produto vencido no estoque...", "status": "Pendente"}, {"data": "2025-11-10", "cat": "Fiscal/Financeiro", "desc": "Notas sem senha...", "status": "Pendente"}, {"data": "2025-11-12", "cat": "Vencimento/FEFO", "desc": "Solicita√ß√£o de baixa, produto vencido...", "status": "Pendente"}, {"data": "2025-11-13", "cat": "Devolu√ß√£o", "desc": "Unidade TCG apresentou R$ 3.829.517,77 em devolu√ß√µes...", "status": "Pendente"}, {"data": "2025-11-13", "cat": "Vencimento/FEFO", "desc": "Solicita√ß√£o de baixa, motivo data de vencimento expirada...", "status": "Pendente"}, {"data": "2025-11-17", "cat": "Devolu√ß√£o", "desc": "Nota de devolu√ß√£o onde o cliente n√£o solicitou...", "status": "Pendente"}, {"data": "2025-11-17", "cat": "Devolu√ß√£o", "desc": "Notas de devolu√ß√£o sem senha...", "status": "Pendente"}, {"data": "2025-11-19", "cat": "Fiscal/Financeiro", "desc": "Notas sem senha...", "status": "Pendente"}, {"data": "2025-11-19", "cat": "Fiscal/Financeiro", "desc": "Notas sem senha...", "status": "Pendente"}, {"data": "2025-11-19", "cat": "Devolu√ß√£o", "desc": "Notas devolvidas devido ao cliente n√£o ter solicitado...", "status": "Pendente"}, {"data": "2025-11-19", "cat": "Vencimento/FEFO", "desc": "Fefo, solicita√ß√£o de baixa produto data expirada...", "status": "Pendente"}, {"data": "2025-11-19", "cat": "Vencimento/FEFO", "desc": "Produto vencido dentro da unidade...", "status": "Pendente"}, {"data": "2025-11-22", "cat": "Vencimento/FEFO", "desc": "Produto vencido no estoque...", "status": "Pendente"}, {"data": "2025-11-22", "cat": "Vencimento/FEFO", "desc": "Produto com data de vencimento expirada...", "status": "Pendente"}, {"data": "2025-11-24", "cat": "Fiscal/Financeiro", "desc": "Notas sem senha...", "status": "Pendente"}, {"data": "2025-11-24", "cat": "Devolu√ß√£o", "desc": "Notas devolu√ß√£o, cliente nao solicitou...", "status": "Pendente"}]},
            {"filial": "TCG", "responsavel": "Jose Oscar", "anomalias": 10, "planos": 0, "status": "Pendente", "diretoria": "Logistica", "detalhes": [{"data": "2025-11-14", "cat": "Diverg√™ncia/Estoque", "desc": "Produtos misturados, aliment√≠cios com outros produtos...", "status": "Pendente"}, {"data": "2025-11-14", "cat": "Avaria", "desc": "Revis√£o das condi√ß√µes de organiza√ß√£o da unidade MCD E TCG...", "status": "Pendente"}, {"data": "2025-11-14", "cat": "Avaria", "desc": "Revis√£o das condi√ß√µes de organiza√ß√£o...", "status": "Pendente"}, {"data": "2025-11-14", "cat": "Avaria", "desc": "Revis√£o das condi√ß√µes de organiza√ß√£o...", "status": "Pendente"}, {"data": "2025-11-14", "cat": "Avaria", "desc": "Revis√£o das condi√ß√µes de organiza√ß√£o...", "status": "Pendente"}, {"data": "2025-11-14", "cat": "Avaria", "desc": "Revis√£o das condi√ß√µes de organiza√ß√£o...", "status": "Pendente"}, {"data": "2025-11-14", "cat": "Avaria", "desc": "Produtos com altos √≠ndices de avarias...", "status": "Pendente"}, {"data": "2025-11-17", "cat": "Avaria", "desc": "REGISTRO DE BAIXA POR AVARIA 89278-263...", "status": "Pendente"}, {"data": "2025-11-22", "cat": "Diverg√™ncia/Estoque", "desc": "Aten√ß√£o redobrada quanto a organiza√ß√£o dos produtos...", "status": "Pendente"}, {"data": "2025-11-24", "cat": "Avaria", "desc": "Produtos avaria interna, Degusta√ß√£o indevida...", "status": "Pendente"}]},
            {"filial": "TCG", "responsavel": "Leonardo Rosa", "anomalias": 1, "planos": 1, "status": "Conclu√≠do", "diretoria": "Comercial", "detalhes": [{"data": "2025-10-30", "cat": "Devolu√ß√£o", "desc": "Diverg√™ncias de informa√ß√µes nas entregas da pra√ßa Dourados...", "status": "Conclu√≠do"}]},
            {"filial": "TCV", "responsavel": "Carlos Eduardo da Silva Camargo", "anomalias": 1, "planos": 1, "status": "Atrasado", "diretoria": "Comercial", "detalhes": [{"data": "2025-11-12", "cat": "Devolu√ß√£o", "desc": "Unidade TCV apresentou R$ 1.962.383,11 em devolu√ß√µes...", "status": "Atrasado"}]},
            {"filial": "TCV", "responsavel": "Christian Miranda", "anomalias": 1, "planos": 0, "status": "Conclu√≠do", "diretoria": "Comercial", "detalhes": [{"data": "2025-11-10", "cat": "Outros", "desc": "Ajuste na carteira de clientes, rota 150...", "status": "Conclu√≠do"}]},
            {"filial": "TPH", "responsavel": "Laudinil Souza Penteado", "anomalias": 1, "planos": 0, "status": "Pendente", "diretoria": "Comercial", "detalhes": [{"data": "2025-11-13", "cat": "Devolu√ß√£o", "desc": "Unidade TPH apresentou R$ 3.829.517,77 em devolu√ß√µes...", "status": "Pendente"}]},
            {"filial": "TPH", "responsavel": "Luiz Silva", "anomalias": 5, "planos": 3, "status": "Pendente", "diretoria": "Logistica", "detalhes": [{"data": "2025-10-28", "cat": "Fiscal/Financeiro", "desc": "28/10/2025 tiveram 06 notas da Qu√≠mica Amparo informadas sem estarem no CAP...", "status": "Conclu√≠do"}, {"data": "2025-11-10", "cat": "Diverg√™ncia/Estoque", "desc": "Identificado falha no processo de recebimento de cargas...", "status": "Conclu√≠do"}, {"data": "2025-11-14", "cat": "Fiscal/Financeiro", "desc": "Identificado notas fiscais de entrada lan√ßadas sem o v√≠nculo...", "status": "Pendente"}, {"data": "2025-11-18", "cat": "Outros", "desc": "Port√£o da doca 3 com problemas no motor...", "status": "Pendente"}, {"data": "2025-11-19", "cat": "Avaria", "desc": "Identificado vazamento no telhado sobre a √°rea de armazenagem...", "status": "Pendente"}]},
            {"filial": "TPH", "responsavel": "Magno Souza", "anomalias": 1, "planos": 1, "status": "Em Dia", "diretoria": "Logistica", "detalhes": [{"data": "2025-11-13", "cat": "Devolu√ß√£o", "desc": "Unidade TPH apresentou um total de R$ 3.829.517,77 em devolu√ß√µes...", "status": "Em Dia"}]},
            {"filial": "TPH", "responsavel": "Rodrigo Bertoni", "anomalias": 8, "planos": 5, "status": "Pendente", "diretoria": "Comercial", "detalhes": [{"data": "2025-10-29", "cat": "Vencimento/FEFO", "desc": "Produtos de FEFO vencidos dentro do CD...", "status": "Conclu√≠do"}, {"data": "2025-10-31", "cat": "Vencimento/FEFO", "desc": "Produtos de FEFO vencidos dentro do CD...", "status": "Conclu√≠do"}, {"data": "2025-10-31", "cat": "Vencimento/FEFO", "desc": "Produtos de FEFO vencidos dentro do CD...", "status": "Pendente"}, {"data": "2025-11-04", "cat": "Vencimento/FEFO", "desc": "Produtos de FEFO vencidos dentro do CD...", "status": "Conclu√≠do"}, {"data": "2025-11-07", "cat": "Vencimento/FEFO", "desc": "Produtos de FEFO vencidos dentro do CD...", "status": "Conclu√≠do"}, {"data": "2025-11-13", "cat": "Vencimento/FEFO", "desc": "Produtos de FEFO vencidos dentro do CD...", "status": "Pendente"}, {"data": "2025-11-13", "cat": "Devolu√ß√£o", "desc": "Unidade TPH apresentou R$ 3.829.517,77 em devolu√ß√µes...", "status": "Pendente"}, {"data": "2025-11-21", "cat": "Vencimento/FEFO", "desc": "Tratando como chegamos a ter mais de 500 mil em produtos vencidos...", "status": "Em Dia"}]},
            {"filial": "TPH", "responsavel": "Ronaldo Crispim", "anomalias": 10, "planos": 0, "status": "Pendente", "diretoria": "Logistica", "detalhes": [{"data": "2025-11-11", "cat": "Diverg√™ncia/Estoque", "desc": "Ajustes de estoque realizados sem justificativa clara...", "status": "Pendente"}, {"data": "2025-11-11", "cat": "Diverg√™ncia/Estoque", "desc": "Diverg√™ncia de estoque no item 102030...", "status": "Pendente"}, {"data": "2025-11-11", "cat": "Diverg√™ncia/Estoque", "desc": "Diverg√™ncia de estoque no item 405060...", "status": "Pendente"}, {"data": "2025-11-11", "cat": "Avaria", "desc": "Palete PBR quebrado na posi√ß√£o A-12-03...", "status": "Pendente"}, {"data": "2025-11-11", "cat": "Outros", "desc": "Lixo acumulado no corredor 4...", "status": "Pendente"}, {"data": "2025-11-11", "cat": "Outros", "desc": "Extintor de inc√™ndio da doca 2 vencido...", "status": "Pendente"}, {"data": "2025-11-11", "cat": "Outros", "desc": "Luz de emerg√™ncia do setor de expedi√ß√£o queimada...", "status": "Pendente"}, {"data": "2025-11-11", "cat": "Outros", "desc": "Empilhadeira 03 apresentando vazamento de √≥leo...", "status": "Pendente"}, {"data": "2025-11-11", "cat": "Outros", "desc": "Transpaleteira manual 05 com roda travada...", "status": "Pendente"}, {"data": "2025-11-11", "cat": "Outros", "desc": "Colaborador sem EPI na √°rea operacional...", "status": "Pendente"}]},
            {"filial": "TSJ", "responsavel": "Ana Cristina", "anomalias": 1, "planos": 3, "status": "Em Dia", "diretoria": "Comercial", "detalhes": [{"data": "2025-11-13", "cat": "Fiscal/Financeiro", "desc": "Inadimplencia de cliente que tinha restri√ß√£o de compra...", "status": "Em Dia"}]},
            {"filial": "TSJ", "responsavel": "Carlos Saldanha", "anomalias": 7, "planos": 0, "status": "Pendente", "diretoria": "Comercial", "detalhes": [{"data": "2025-10-30", "cat": "Vencimento/FEFO", "desc": "Nota de Troca com Produto Fora do Prazo...", "status": "Pendente"}, {"data": "2025-10-30", "cat": "Vencimento/FEFO", "desc": "Nota de Troca com Produto Fora do Prazo...", "status": "Pendente"}, {"data": "2025-10-30", "cat": "Vencimento/FEFO", "desc": "Nota de Troca com Produto Fora do Prazo...", "status": "Pendente"}, {"data": "2025-10-30", "cat": "Vencimento/FEFO", "desc": "Nota de Troca com Produto Fora do Prazo...", "status": "Pendente"}, {"data": "2025-10-30", "cat": "Vencimento/FEFO", "desc": "Nota de Troca com Produto Fora do Prazo...", "status": "Pendente"}, {"data": "2025-11-04", "cat": "Avaria", "desc": "NF de trocas com produtos avariados...", "status": "Pendente"}, {"data": "2025-11-18", "cat": "Diverg√™ncia/Estoque", "desc": "Nota de Troca com Produto a mais...", "status": "Pendente"}]},
            {"filial": "TSJ", "responsavel": "Cristiano Rodrigues", "anomalias": 1, "planos": 0, "status": "Pendente", "diretoria": "Comercial", "detalhes": [{"data": "2025-11-12", "cat": "Devolu√ß√£o", "desc": "Unidade TSJ apresentou R$ 511.458,56 em devolu√ß√µes...", "status": "Pendente"}]},
            {"filial": "TSJ", "responsavel": "Fabricio Ribeiro", "anomalias": 4, "planos": 6, "status": "Em Dia", "diretoria": "Logistica", "detalhes": [{"data": "2025-11-10", "cat": "Outros", "desc": "Sensor de presen√ßa do corredor 3 disparando...", "status": "Conclu√≠do"}, {"data": "2025-11-10", "cat": "Outros", "desc": "Port√£o autom√°tico da entrada principal travando...", "status": "Conclu√≠do"}, {"data": "2025-11-11", "cat": "Outros", "desc": "Vazamento na torneira do banheiro masculino...", "status": "Em Dia"}, {"data": "2025-11-12", "cat": "Outros", "desc": "L√¢mpada do escrit√≥rio queimada...", "status": "Conclu√≠do"}]}
        ];

        const CREDENCIAIS = {
            'admin': {pass:'admin123', view:'TODOS', name:'Administrador'},
            'ademir': {pass:'log123', view:'Logistica', name:'Ademir Lobato'},
            'saulo': {pass:'com123', view:'Comercial', name:'Saulo'},
            'ana': {pass:'rh123', view:'Gente', name:'Ana'},
            'fagnes': {pass:'fin123', view:'Financeiro', name:'Fagnes'},
            'luis': {pass:'prev123', view:'Prevencao', name:'Lu√≠s'}
        };

        // --- L√ìGICA ---
        let usuarioAtual = null;
        function handleEnter(e) { if(e.key==='Enter') fazerLogin(); }
        function fazerLogin() {
            const u = document.getElementById('user').value.toLowerCase().trim();
            const p = document.getElementById('pass').value;
            if(CREDENCIAIS[u] && CREDENCIAIS[u].pass === p) {
                usuarioAtual = CREDENCIAIS[u];
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('dashboardContainer').style.display = 'block';
                document.getElementById('userBadge').innerText = usuarioAtual.name + (usuarioAtual.view !== 'TODOS' ? ` (${usuarioAtual.view})` : ' (Admin)');
                renderizarDashboard(usuarioAtual.view);
            } else {
                document.getElementById('errorMsg').style.display = 'block';
            }
        }
        function logout() { location.reload(); }

        let ordenacao = { col: 'anomalias', dir: 'desc' };
        function renderizarDashboard(view) {
            let dados = view === 'TODOS' ? [...dadosBanco] : dadosBanco.filter(d => d.diretoria === view);
            dados.sort((a,b) => {
                let vA = a[ordenacao.col], vB = b[ordenacao.col];
                if(typeof vA === 'string') return ordenacao.dir==='asc' ? vA.localeCompare(vB) : vB.localeCompare(vA);
                return ordenacao.dir==='asc' ? vA - vB : vB - vA;
            });

            let total=0, pend=0, atrasado=0, conc=0;
            dados.forEach(d => {
                total += d.anomalias;
                if(d.status==='Pendente') pend+=d.anomalias;
                else if(d.status==='Atrasado') atrasado+=d.anomalias;
                else conc+=d.anomalias;
            });
            document.getElementById('kpiTotal').innerText = total;
            document.getElementById('kpiPendente').innerText = pend;
            document.getElementById('kpiAtrasado').innerText = atrasado;
            document.getElementById('kpiConcluido').innerText = conc;

            const tbody = document.getElementById('tabelaCorpo');
            tbody.innerHTML = '';
            dados.forEach(d => {
                let bg = d.status==='Em Dia'?'bg-concluido':(d.status==='Atrasado'?'bg-atrasado':(d.status==='Conclu√≠do'?'bg-concluido':'bg-pendente'));
                let tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><strong>${d.filial}</strong></td>
                    <td><a class="link-responsavel" onclick='abrirDetalhes(${JSON.stringify(d)})'>${d.responsavel}</a></td>
                    <td style="text-align:center;">${d.anomalias}</td>
                    <td style="text-align:center;">${d.planos}</td>
                    <td style="text-align:center;"><span class="badge ${bg}">${d.status}</span></td>
                    <td><button onclick='abrirDetalhes(${JSON.stringify(d)})' style="cursor:pointer; border:1px solid #ccc; background:#fff; border-radius:4px;">üîç Ver</button></td>
                `;
                tbody.appendChild(tr);
            });
            renderizarGraficos(dados);
        }

        function renderizarGraficos(dados) {
            let statusMap = {'Pendente':0, 'Atrasado':0, 'Conclu√≠do':0};
            dados.forEach(d => {
                let s = (d.status==='Em Dia' || d.status==='Conclu√≠do') ? 'Conclu√≠do' : d.status;
                statusMap[s] += d.anomalias;
            });
            let ctxS = document.getElementById('chartStatus').getContext('2d');
            if(window.chartS instanceof Chart) window.chartS.destroy();
            window.chartS = new Chart(ctxS, {
                type: 'doughnut',
                data: { labels: Object.keys(statusMap), datasets: [{ data: Object.values(statusMap), backgroundColor: ['#dc3545','#fd7e14','#28a745'] }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { title: {display:true, text:'Status Geral'} } }
            });

            let top = [...dados].sort((a,b) => b.anomalias - a.anomalias).slice(0, 5);
            let ctxR = document.getElementById('chartResponsavel').getContext('2d');
            if(window.chartR instanceof Chart) window.chartR.destroy();
            window.chartR = new Chart(ctxR, {
                type: 'bar',
                data: { labels: top.map(d => d.responsavel.split(' ')[0]), datasets: [{ label: 'Qtd', data: top.map(d => d.anomalias), backgroundColor: '#0056b3' }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: {display:false}, title: {display:true, text:'Top 5 Ofensores'} } }
            });
        }

        function ordenar(col) {
            ordenacao.dir = (ordenacao.col === col && ordenacao.dir === 'desc') ? 'asc' : 'desc';
            ordenacao.col = col;
            renderizarDashboard(usuarioAtual.view);
        }

        function abrirDetalhes(item) {
            document.getElementById('modalTitulo').innerText = item.responsavel;
            document.getElementById('modalSubtitulo').innerText = `${item.filial} | ${item.diretoria}`;
            const tbody = document.getElementById('modalCorpo');
            tbody.innerHTML = '';
            item.detalhes.forEach(det => {
                let badgeClass = det.status==='Pendente'?'bg-pendente':(det.status==='Conclu√≠do'?'bg-concluido':'bg-atrasado');
                let tr = `<tr>
                    <td>${det.data}</td>
                    <td><span class="badge ${badgeClass}">${det.status}</span></td>
                    <td><span class="cat-tag">${det.cat}</span></td>
                    <td style="color:#666;">${det.desc}</td>
                </tr>`;
                tbody.innerHTML += tr;
            });
            document.getElementById('detalhesModal').style.display = 'block';
        }
        function fecharModal() { document.getElementById('detalhesModal').style.display = 'none'; }
        window.onclick = function(e) { if(e.target == document.getElementById('detalhesModal')) fecharModal(); }
    </script>
</body>
</html>
