<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Anomalias</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5; margin: 0; padding: 20px; color: #333; }
        
        /* LOGIN */
        #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .login-box { background: white; padding: 40px; border-radius: 12px; width: 350px; box-shadow: 0 15px 35px rgba(0,0,0,0.5); text-align: center; }
        .login-input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; }
        .login-btn { width: 100%; padding: 12px; background: #0056b3; color: white; border: none; border-radius: 6px; font-size: 16px; cursor: pointer; font-weight: bold; }
        .login-btn:hover { background: #004494; }
        
        /* MODAL */
        #detalhesModal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); backdrop-filter: blur(3px); }
        .modal-content { background-color: #fff; margin: 5% auto; padding: 25px; border-radius: 10px; width: 85%; max-width: 950px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); position: relative; }
        .close-btn { position: absolute; right: 20px; top: 15px; font-size: 28px; font-weight: bold; cursor: pointer; color: #aaa; }
        .close-btn:hover { color: #333; }

        /* LAYOUT */
        .header { background: #fff; padding: 20px 30px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border-left: 5px solid #0056b3; }
        .header h1 { margin: 0; font-size: 24px; color: #004085; }
        
        .kpi-container { display: flex; gap: 20px; margin-bottom: 30px; flex-wrap: wrap; }
        .kpi-card { flex: 1; min-width: 200px; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); border-left: 5px solid #ccc; }
        .kpi-card h3 { margin: 0 0 10px; font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 1px; }
        .kpi-card .value { font-size: 38px; font-weight: 700; color: #333; }
        .kpi-blue { border-color: #007bff; } .kpi-red { border-color: #dc3545; } .kpi-orange { border-color: #fd7e14; } .kpi-green { border-color: #28a745; }

        .table-container { background: #fff; padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); overflow-x: auto; margin-top: 20px; }
        table { width: 100%; border-collapse: separate; border-spacing: 0; min-width: 800px; }
        th { padding: 15px; text-align: left; background: #f8f9fa; color: #555; font-weight: 700; border-bottom: 2px solid #e9ecef; cursor: pointer; }
        td { padding: 12px 15px; border-bottom: 1px solid #f1f1f1; font-size: 14px; vertical-align: middle; }
        tr:hover { background-color: #f8f9fa; }
        
        .badge { padding: 5px 12px; border-radius: 20px; font-size: 11px; font-weight: bold; color: #fff; display: inline-block; min-width: 80px; text-align: center; }
        .bg-pendente { background-color: #dc3545; } .bg-atrasado { background-color: #fd7e14; } .bg-concluido { background-color: #28a745; }
        
        .tabela-detalhe { width: 100%; margin-top: 15px; }
        .tabela-detalhe th { background: #0056b3; color: white; font-size: 13px; }
        .tabela-detalhe td { border: 1px solid #dee2e6; font-size: 13px; vertical-align: top; }
        .tabela-detalhe tr:nth-child(even) { background-color: #f8f9fa; }
        .cat-tag { background: #e9ecef; color: #495057; padding: 3px 8px; border-radius: 4px; font-weight: bold; font-size: 11px; display: inline-block; white-space: nowrap; }
        .link-nome { color: #0056b3; font-weight: 600; cursor: pointer; text-decoration: none; }
        .link-nome:hover { text-decoration: underline; }
    </style>
</head>
<body>

    <div id="loginOverlay">
        <div class="login-box">
            <h2 style="color: #004085;">Triunfante</h2>
            <p style="color: #666; margin-bottom: 20px;">Acesso Executivo</p>
            <input type="text" id="user" class="login-input" placeholder="Usu√°rio" onkeypress="handleEnter(event)">
            <input type="password" id="pass" class="login-input" placeholder="Senha" onkeypress="handleEnter(event)">
            <button class="login-btn" onclick="fazerLogin()">Entrar</button>
            <p id="errorMsg" style="color: red; font-size: 13px; margin-top: 10px; display: none;">Dados incorretos.</p>
        </div>
    </div>

    <div id="detalhesModal">
        <div class="modal-content">
            <span class="close-btn" onclick="fecharModal()">&times;</span>
            <h2 id="modalTitulo" style="color: #004085; margin: 0 0 5px 0;">Detalhes</h2>
            <p id="modalSubtitulo" style="color: #666; margin: 0 0 20px 0;"></p>
            <div style="overflow-x: auto; max-height: 400px;">
                <table class="tabela-detalhe">
                    <thead><tr><th width="12%">Data</th><th width="10%">Status</th><th width="25%">Motivo</th><th width="53%">Descri√ß√£o Original</th></tr></thead>
                    <tbody id="modalCorpo"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="dashboardContainer" style="display: none;">
        <div class="header">
            <div><h1>Dashboard de Anomalias</h1><small style="color: #666;">Monitoramento e Tratativas</small></div>
            <div style="display: flex; gap: 15px; align-items: center;">
                <span id="userBadge" style="background: #e9ecef; padding: 6px 12px; border-radius: 4px; font-weight: bold; color: #555; font-size: 14px;"></span>
                <button onclick="logout()" style="padding: 8px 15px; border: 1px solid #ccc; background: white; border-radius: 4px; cursor: pointer; font-weight: bold;">Sair</button>
            </div>
        </div>

        <div class="kpi-container">
            <div class="kpi-card kpi-blue"><h3>Total Geral</h3><div class="value" id="kpiTotal">0</div></div>
            <div class="kpi-card kpi-red"><h3>Pendentes</h3><div class="value" id="kpiPendente">0</div></div>
            <div class="kpi-card kpi-orange"><h3>Atrasados</h3><div class="value" id="kpiAtrasado">0</div></div>
            <div class="kpi-card kpi-green"><h3>Conclu√≠dos</h3><div class="value" id="kpiConcluido">0</div></div>
        </div>

        <div style="display: flex; gap: 20px; flex-wrap: wrap;">
            <div class="table-container" style="flex: 1; min-width: 300px; height: 380px; margin-top:0;">
                <canvas id="chartStatus"></canvas>
            </div>
            <div class="table-container" style="flex: 1; min-width: 300px; height: 380px; margin-top:0;">
                <canvas id="chartResponsavel"></canvas>
            </div>
            <div class="table-container" style="flex: 1; min-width: 300px; height: 380px; margin-top:0;">
                <canvas id="chartMotivos"></canvas> </div>
        </div>

        <div class="table-container">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3 style="margin: 0; color: #444;">üìã Vis√£o Detalhada</h3>
                <select id="filtroDiretoria" onchange="alterarFiltroDiretoria(this.value)" style="padding: 8px; border-radius: 4px; border: 1px solid #ccc;"></select>
            </div>
            <p style="font-size: 13px; color: #888; margin-top: 5px;">*Clique no nome para ver detalhes.</p>
            <table style="margin-top: 15px;">
                <thead><tr><th onclick="ordenar('filial')">Filial ‚Üï</th><th onclick="ordenar('responsavel')">Respons√°vel ‚Üï</th><th onclick="ordenar('anomalias')" style="text-align: center;">Anomalias ‚Üï</th><th onclick="ordenar('planos')" style="text-align: center;">Planos ‚Üï</th><th onclick="ordenar('status')" style="text-align: center;">Status Geral ‚Üï</th><th>A√ß√£o</th></tr></thead>
                <tbody id="tabelaCorpo"></tbody>
            </table>
        </div>
    </div>

    <script>

const dadosBanco = [
    {"filial":"ABC","responsavel":"Graciele Patricia da Silva","anomalias":1,"planos":0,"status":"Pendente","diretoria":"Financeiro","detalhes":[{"dt":"2025-11-27","st":"Pendente","cat":"Pend√™ncia Financeira / Fiscal","desc":"Constata√ß√£o de ANOMALIAS na Unidade de ABC, referentes a PEND√äNCIAS NO CAR, para conhecimento e elab..."}]},
    {"filial":"ABC","responsavel":"Missaid Mainardes","anomalias":1,"planos":4,"status":"Em Dia","diretoria":"Comercial","detalhes":[{"dt":"2025-11-12","st":"Em Dia","cat":"Diverg√™ncia de Estoque","desc":"No per√≠odo de 01/01/2025 a 31/10/2025, a unidade ABC apresentou R$ 1.050.735,23 em devolu√ß√µes, sendo..."}]},
    {"filial":"ABC","responsavel":"Nei Lessak","anomalias":5,"planos":2,"status":"Pendente","diretoria":"Logistica","detalhes":[{"dt":"2025-11-11","st":"Conclu√≠do","cat":"Diverg√™ncia de Estoque","desc":"Referente SOLICITACAO DE BAIXA DE ESTOQUE POR AVARIA - REG-62208-543  , gentileza apresentar PLANO D..."},{"dt":"2025-11-11","st":"Conclu√≠do","cat":"Diverg√™ncia de Estoque","desc":"Referente SOLICITACAO DE BAIXA DE ESTOQUE POR AVARIA - REG-19233-716, gentileza apresentar PLANO DE ..."},{"dt":"2025-11-24","st":"Pendente","cat":"Avaria / Danos","desc":"Constata√ß√£o de ANOMALIA de AVARIAS, em 13NOV25, em ABC (REG 14653-624) que totalizou R$ 547,27, para..."},{"dt":"2025-11-25","st":"Pendente","cat":"Risco de Seguran√ßa / Queda","desc":"Ronda de risco de queda realizada na data de 25/11/2025, foi constatado no a√©reo e sub a√©reo v√°rios ..."},{"dt":"2025-11-27","st":"Pendente","cat":"Pend√™ncia Financeira / Fiscal","desc":"Constata√ß√£o de ANOMALIAS na entrega, na Unidade de ABC, para conhecimento e confec√ß√£o do plano de a√ß..."}]},
    {"filial":"API","responsavel":"Arildo Zago","anomalias":1,"planos":0,"status":"Pendente","diretoria":"Comercial","detalhes":[{"dt":"2025-11-13","st":"Pendente","cat":"Diverg√™ncia de Estoque","desc":"No per√≠odo de 01/01/2025 a 31/10/2025, a unidade API apresentou R$ 1.314.189,82 em devolu√ß√µes, com p..."}]},
    {"filial":"API","responsavel":"Cleber Medeiros","anomalias":1,"planos":0,"status":"Pendente","diretoria":"Financeiro","detalhes":[{"dt":"2025-11-27","st":"Pendente","cat":"Pend√™ncia Financeira / Fiscal","desc":"Constata√ß√£o de ANOMALIAS no CAR de API, para conhecimento e elabora√ß√£o de plano de a√ß√£o que vise eli..."}]},
    {"filial":"API","responsavel":"Magno Souza","anomalias":1,"planos":1,"status":"Conclu√≠do","diretoria":"Logistica","detalhes":[{"dt":"2025-11-13","st":"Conclu√≠do","cat":"Diverg√™ncia de Estoque","desc":"No per√≠odo de 01/01/2025 a 31/10/2025, a unidade API apresentou um total de R$ 1.314.189,82 em devol..."}]},
    {"filial":"API","responsavel":"Marcos Nichelle","anomalias":2,"planos":2,"status":"Atrasado","diretoria":"Comercial","detalhes":[{"dt":"2025-11-12","st":"Conclu√≠do","cat":"Produto Vencido / FEFO","desc":"Produtos vencidos que estavam sendo sinalizados com anteced√™ncia para que ocorrerem a√ß√µes de vendas ..."},{"dt":"2025-11-19","st":"Atrasado","cat":"Produto Vencido / FEFO","desc":"Elaborar plano de a√ß√£o para redu√ß√£o de vencidos..."}]},
    {"filial":"API","responsavel":"Ronaldo Crispim","anomalias":3,"planos":0,"status":"Pendente","diretoria":"Logistica","detalhes":[{"dt":"2025-10-31","st":"Pendente","cat":"Diverg√™ncia de Estoque","desc":"Ajustes de estoques constatados no inventario parcial que prrecisam de medidas tratativas ..."},{"dt":"2025-11-11","st":"Pendente","cat":"Diverg√™ncia de Estoque","desc":"Solicita√ß√£o de baixa de estoque, requer plano de a√ß√£o para reduzir as ocorr√™ncias dessas faltas e so..."},{"dt":"2025-11-27","st":"Pendente","cat":"Pend√™ncia Financeira / Fiscal","desc":"Constata√ß√£o de ANOMALIAS nas ENTREGAS, na Unidade de API, para conhecimento e elabora√ß√£o do plano de..."}]},
    {"filial":"CTD","responsavel":"Ademir Lobato","anomalias":1,"planos":0,"status":"Pendente","diretoria":"Logistica","detalhes":[{"dt":"2025-11-25","st":"Pendente","cat":"Diverg√™ncia de Estoque","desc":"Ademir, abro a anomalia para movimenta√ß√µes que se encontram represadas na data de hoje. Pe√ßo apoio q..."}]},
    {"filial":"CTD","responsavel":"Luis Correia","anomalias":1,"planos":0,"status":"Pendente","diretoria":"Outros","detalhes":[{"dt":"2025-11-29","st":"Pendente","cat":"Processo Operacional","desc":"N√£o est√° sendo poss√≠vel baixar arquivos de anomalias criadas por terceiros e atribu√≠das a mim...."}]},
    {"filial":"MCD","responsavel":"Ademir Lobato","anomalias":1,"planos":0,"status":"Pendente","diretoria":"Logistica","detalhes":[{"dt":"2025-11-11","st":"Pendente","cat":"Risco de Seguran√ßa / Queda","desc":"O local apresenta uma grande quantidade de fezes de roedores, indicando infesta√ß√£o ativa. Essa condi..."}]},
    {"filial":"MCD","responsavel":"Adriana Rocha","anomalias":1,"planos":0,"status":"Pendente","diretoria":"Gente","detalhes":[{"dt":"2025-11-30","st":"Pendente","cat":"Processo Operacional","desc":"Encaminho reclama√ß√£o que foi feita pelos colaboradores Alcides Henrique Lemos Monzon Queiroz, Cezar ..."}]},
    {"filial":"MCD","responsavel":"Cleverson Kuba","anomalias":4,"planos":0,"status":"Pendente","diretoria":"Comercial","detalhes":[{"dt":"2025-11-04","st":"Pendente","cat":"Diverg√™ncia de Estoque","desc":"Produtos  topei pacoca vencidos no estoque validade 01/11/2025..."},{"dt":"2025-11-06","st":"Pendente","cat":"Diverg√™ncia de Estoque","desc":"produtos vencidos no  estoque por gentileza realizar processo de baixa..."},{"dt":"2025-11-13","st":"Pendente","cat":"Diverg√™ncia de Estoque","desc":"produtos vencidos no  estoque solicito por gentileza a baixa do iterm ...."},{"dt":"2025-11-17","st":"Pendente","cat":"Diverg√™ncia de Estoque","desc":"produto vencido no  estoque ..."}]},
    {"filial":"MCD","responsavel":"Emanuel Boscolo","anomalias":2,"planos":5,"status":"Atrasado","diretoria":"Financeiro","detalhes":[{"dt":"2025-11-05","st":"Conclu√≠do","cat":"Pend√™ncia Financeira / Fiscal","desc":"Na data de hoje(05/11/2025), na Unidade de MCD, teve um pagamento para a DUCOCO ALIMENTOS SA, NF 187..."},{"dt":"2025-11-26","st":"Atrasado","cat":"Pend√™ncia Financeira / Fiscal","desc":"Constata√ß√£o de ANOMALIAS no CAR da Unidade de MCD, para conhecimento e confec√ß√£o de plano de a√ß√£o qu..."}]},
    {"filial":"MCD","responsavel":"Fabio Rogerio","anomalias":1,"planos":0,"status":"Pendente","diretoria":"Comercial","detalhes":[{"dt":"2025-11-13","st":"Pendente","cat":"Diverg√™ncia de Estoque","desc":"No per√≠odo de 01/01/2025 a 31/10/2025, a unidade MCD apresentou R$ 4.221.881,60 em devolu√ß√µes, sendo..."}]},
    {"filial":"MCD","responsavel":"Jose Oscar","anomalias":18,"planos":25,"status":"Atrasado","diretoria":"Logistica","detalhes":[{"dt":"2025-11-11","st":"Em Dia","cat":"Controle de Pragas / Higiene","desc":"Encontrado roedor na carga de n√∫mero 10427 durante o processo de carregamento.  ..."},{"dt":"2025-11-11","st":"Em Dia","cat":"Controle de Pragas / Higiene","desc":"Encontrado  na rua k  posi√ß√£o k005 um roedor esmagado ..."},{"dt":"2025-11-11","st":"Em Dia","cat":"Processo Operacional","desc":"Presen√ßa  do item colgate prote√ß√£o  ativa misturados  com os demais  itens na posi√ß√£o o0040 ..."},{"dt":"2025-11-11","st":"Em Dia","cat":"Pend√™ncia Financeira / Fiscal","desc":"Restos de equipe  descartado em local impr√≥prio ..."},{"dt":"2025-11-11","st":"Em Dia","cat":"Avaria / Danos","desc":"Produtos fracionados  fora do padrao  de organiza√ß√£o  Gerando avarias ..."},{"dt":"2025-11-11","st":"Em Dia","cat":"Processo Operacional","desc":"Produto desorganizado no pick fora de padr√£o ..."},{"dt":"2025-11-11","st":"Em Dia","cat":"Risco de Seguran√ßa / Queda","desc":"Palet ra√ß√£o no a√©reo risco de queda ..."},{"dt":"2025-11-11","st":"Em Dia","cat":"Avaria / Danos","desc":"Avaria colgate com outros itens em bom estado de venda ..."},{"dt":"2025-11-11","st":"Em Dia","cat":"Controle de Pragas / Higiene","desc":"Avarias no ch√£o  em v√°rias ruas de Mcd atraindo roedores pombos e moscas ..."},{"dt":"2025-11-11","st":"Em Dia","cat":"Processo Operacional","desc":"Placas de identifica√ß√£o  de rua no. Ch√£o ..."},{"dt":"2025-11-11","st":"Em Dia","cat":"Avaria / Danos","desc":"Avarias por consumo  indevido biscoito e batatas no final. Das. Ruasc..."},{"dt":"2025-11-11","st":"Em Dia","cat":"Controle de Pragas / Higiene","desc":"Lixo e sujeira junto com produtos  fracionados Gerando avaria fora de padr√£o de organiza√ß√£o ..."},{"dt":"2025-11-11","st":"Em Dia","cat":"Controle de Pragas / Higiene","desc":"Fezes de roedores,produtos avariado em meio a produtos em bom estado podendo contaminar ..."},{"dt":"2025-11-16","st":"Em Dia","cat":"Risco de Seguran√ßa / Queda","desc":"Posi√ß√µes com risco de queda de produtos, pois esses produtos n√£o est√£o alocados de forma correta no ..."},{"dt":"2025-11-17","st":"Em Dia","cat":"Avaria / Danos","desc":"sabonetes na rua N posi√ß√£o 57.0 molhando gerando avaria ..."},{"dt":"2025-11-26","st":"Atrasado","cat":"Pend√™ncia Financeira / Fiscal","desc":"Constata√ß√£o de ANOMALIAS nas entregas, na Unidade de MCD, para conhecimento e confec√ß√£o de plano de ..."},{"dt":"2025-11-27","st":"Em Dia","cat":"Diverg√™ncia de Estoque","desc":"Produto vencido no estoque necess√°rio alocar  em local separado  ..."},{"dt":"2025-11-27","st":"Em Dia","cat":"Produto Vencido / FEFO","desc":"Solicito retirada  dos produtos  vencido dos local sinalizado pelo time de preven√ß√£o  para n√£o haver..."}]},
    {"filial":"MCD","responsavel":"Luana Santos","anomalias":6,"planos":0,"status":"Pendente","diretoria":"Outros","detalhes":[{"dt":"2025-11-30","st":"Pendente","cat":"Diverg√™ncia de Estoque","desc":"Solicito posicionamento para retirada desses itens em FEFO de posi√ß√µes dentro do estoque...."},{"dt":"2025-11-30","st":"Pendente","cat":"Diverg√™ncia de Estoque","desc":"Solicito posicionamento para retirada desses itens em FEFO de posi√ß√µes dentro do estoque...."},{"dt":"2025-11-30","st":"Pendente","cat":"Diverg√™ncia de Estoque","desc":"Solicito posicionamento para retirada desses itens em FEFO de posi√ß√µes dentro do estoque...."},{"dt":"2025-11-30","st":"Pendente","cat":"Controle de Pragas / Higiene","desc":"Estamos sendo muito cobrados por conta da quest√£o de itens com avarias e que causam presen√ßa de inse..."},{"dt":"2025-11-30","st":"Pendente","cat":"Risco de Seguran√ßa / Queda","desc":"Tivemos um relato de roubo de um par de t√™nis do Funcion√°rio Lohran. Solicitamos imagens de c√¢meras ..."},{"dt":"2025-11-30","st":"Pendente","cat":"Pend√™ncia Financeira / Fiscal","desc":"Durante v√°rios meses estamos pedindo apoio num plano de combate a m√°s pr√°ticas dentro do CD. A menos..."}]},
    {"filial":"MCD","responsavel":"Magno Souza","anomalias":1,"planos":2,"status":"Em Dia","diretoria":"Logistica","detalhes":[{"dt":"2025-11-13","st":"Em Dia","cat":"Diverg√™ncia de Estoque","desc":"No per√≠odo de 01/01/2025 a 31/10/2025, a unidade MCD apresentou um total de R$ 4.221.881,60 em devol..."}]},
    {"filial":"TBE","responsavel":"Jonas Portela","anomalias":4,"planos":2,"status":"Atrasado","diretoria":"Logistica","detalhes":[{"dt":"2025-11-12","st":"Atrasado","cat":"Processo Operacional","desc":"Sa√≠das de Emerg√™ncia - Solicitado Lacres. Uma das sa√≠das, est√° obstru√≠da...."},{"dt":"2025-11-26","st":"Pendente","cat":"Pend√™ncia Financeira / Fiscal","desc":"Constata√ß√£o de ANOMALIAS na Unidade de TPA, para conhecimento e elabora√ß√£o de plano de a√ß√£o que vise..."}]},
    {"filial":"TBE","responsavel":"Kelly Pereira","anomalias":1,"planos":1,"status":"Conclu√≠do","diretoria":"Gente","detalhes":[{"dt":"2025-10-30","st":"Conclu√≠do","cat":"Diverg√™ncia em NF de Troca","desc":"Prezados,  Desde o dia 17/10/2025 estamos solicitando ao time de Gente e Gest√£o a lista de f√©rias do..."}]},
    {"filial":"TBE","responsavel":"Luis Fernando Feijo Ramos Junior","anomalias":2,"planos":0,"status":"Pendente","diretoria":"Comercial","detalhes":[{"dt":"2025-11-12","st":"Pendente","cat":"Pend√™ncia Financeira / Fiscal","desc":"No per√≠odo de 01/01/2025 a 31/10/2025, a unidade TBA apresentou R$ 830.282,30 em devolu√ß√µes, sendo p..."},{"dt":"2025-11-13","st":"Pendente","cat":"Diverg√™ncia de Estoque","desc":"No per√≠odo de 01/01/2025 a 31/10/2025, a unidade TBE apresentou R$ 153.633,65 em devolu√ß√µes, com pre..."}]},
    {"filial":"TBE","responsavel":"Patricia Aline Sa Silva","anomalias":4,"planos":5,"status":"Atrasado","diretoria":"Financeiro","detalhes":[{"dt":"2025-10-30","st":"Conclu√≠do","cat":"Pend√™ncia Financeira / Fiscal","desc":"Na data de hoje 30/10/2025, foi informado dois ACORDOS COMERCIAIS em TPA, que n√£o foram inclu√≠dos no..."},{"dt":"2025-11-10","st":"Conclu√≠do","cat":"Diverg√™ncia de Estoque","desc":"Diverg√™ncias nos pagamentos de TPA, na data de hoje 10/11/2025. A Unidade informou no DDA de TPA, um..."},{"dt":"2025-11-26","st":"Em Dia","cat":"Produto Vencido / FEFO","desc":"Hoje em TBE, tivemos notas da MONDELEZ pagas em atraso. Vencimento das notas 21/11/2025(04 NOTAS). V..."},{"dt":"2025-11-27","st":"Pendente","cat":"Pend√™ncia Financeira / Fiscal","desc":"Constata√ß√£o de ANOMALIAS no CAR de TBE, para ci√™ncia e confec√ß√£o de plano de a√ß√£o que vise a elimina..."}]},
    {"filial":"TBE","responsavel":"Paulo Cholet","anomalias":1,"planos":0,"status":"Pendente","diretoria":"Comercial","detalhes":[{"dt":"2025-11-12","st":"Pendente","cat":"Diverg√™ncia de Estoque","desc":"No per√≠odo de 01/01/2025 a 31/10/2025, a unidade TPA apresentou R$ 1.962.383,11 em devolu√ß√µes, sendo..."}]},
    {"filial":"TBL","responsavel":"Edson Bragato","anomalias":5,"planos":5,"status":"Atrasado","diretoria":"Logistica","detalhes":[{"dt":"2025-11-10","st":"Conclu√≠do","cat":"Avaria / Danos","desc":"ASSUNTO: Avaria no ato da entrega ,chocolate derretido. CONSIDERANDO que devem ser tomados, pela Uni..."},{"dt":"2025-11-11","st":"Conclu√≠do","cat":"Risco de Seguran√ßa / Queda","desc":"Realizado rondas de 5s em todos os corredores do  deposito (Unidade TBL) e foi constatados produtos ..."},{"dt":"2025-11-19","st":"Atrasado","cat":"Diverg√™ncia de Estoque","desc":"Produtos Vencidos no estoque FEFO..."}]},
    {"filial":"TBL","responsavel":"Everton Silva","anomalias":1,"planos":0,"status":"Pendente","diretoria":"Comercial","detalhes":[{"dt":"2025-11-12","st":"Pendente","cat":"Diverg√™ncia de Estoque","desc":"No per√≠odo de 01/01/2025 a 31/10/2025, a unidade TBL apresentou R$ 985.792,13 em devolu√ß√µes, sendo a..."}]},
    {"filial":"TBL","responsavel":"Idin√©ia Leite","anomalias":2,"planos":4,"status":"Conclu√≠do","diretoria":"Financeiro","detalhes":[{"dt":"2025-11-10","st":"Conclu√≠do","cat":"Diverg√™ncia de Estoque","desc":"Encontrado desvio no processo de solicita√ß√£o de baixa de estoque, onde um ajuste foi realizado ap√≥s ..."},{"dt":"2025-11-25","st":"Conclu√≠do","cat":"Pend√™ncia Financeira / Fiscal","desc":"Constata√ß√£o de ANOMALIA no CAR de TBL: o t√≠tulo 14347401, no valor de R$ 243,00, emitido contra apre..."}]},
    {"filial":"TBL","responsavel":"Lucas Santana","anomalias":7,"planos":0,"status":"Pendente","diretoria":"Comercial","detalhes":[{"dt":"2025-10-29","st":"Pendente","cat":"Produto Vencido / FEFO","desc":"Cliente: Casa Vila Real  NF 11925  Valor NF.R$:.94,68  Obs: 22 Unid. De √Ågua de Coco Puro Coco 200ml..."},{"dt":"2025-10-29","st":"Pendente","cat":"Produto Vencido / FEFO","desc":"Cliente: Casa Vila Real  NF 11925  Valor NF.R$:.94,68  Obs: 22 Unid. De √Ågua de Coco Puro Coco 200ml..."},{"dt":"2025-10-30","st":"Pendente","cat":"Produto Vencido / FEFO","desc":"Nota:.26796   Valor R$:. 1011,01 Valor Perda R$:. 71,37 Cliente:. MOLINS SUPERMERCADOS  PRODUTOS FOR..."},{"dt":"2025-10-30","st":"Pendente","cat":"Diverg√™ncia de Estoque","desc":"NOTA FISCAL N¬∫ 19800 VALOR R$:. 653,27 CLIENTE:. MOLINS SUPERMERCADOS  MOTIVO: PRODUTOS DISCRIMINADO..."},{"dt":"2025-10-30","st":"Pendente","cat":"Produto Vencido / FEFO","desc":"NOTA FISCAL N¬∫ 10025 VALOR R$:. 187,80 CLIENTE: M L XAVIER SUPERMERCADOS  MOTIVO: PRODUTOS FORA DO P..."},{"dt":"2025-10-30","st":"Pendente","cat":"Produto Vencido / FEFO","desc":"NOTA FISCAL N¬∫ 8730 VALOR R$:. 259,24 CLIENTE: C R V ESTERO E CIA LTDA  MOTIVO: PRODUTOS FORA DO PRA..."},{"dt":"2025-10-30","st":"Pendente","cat":"Produto Vencido / FEFO","desc":"NOTA FISCAL N¬∫ 11925 VALOR R$:. 94,68 VALOR PERDA R$:. 54,78 CLIENTE: CASA VILA REAL  MOTIVO: PRODUT..."}]},
    {"filial":"TBL","responsavel":"Weverton Peixoto","anomalias":1,"planos":1,"status":"Conclu√≠do","diretoria":"Logistica","detalhes":[{"dt":"2025-11-06","st":"Conclu√≠do","cat":"Processo Operacional","desc":"No dia 06/11/2025 as 12h10min foi identificado o mau procedimento do colaborador La√©rcio (log√≠stica)..."}]},
    {"filial":"TCA","responsavel":"Ademir Junior","anomalias":1,"planos":2,"status":"Em Dia","diretoria":"Financeiro","detalhes":[{"dt":"2025-11-26","st":"Em Dia","cat":"Pend√™ncia Financeira / Fiscal","desc":"Constata√ß√£o de ANOMALIAS no CAR da Unidade de TCA, para teu conhecimento e elabora√ß√£o do plano de a√ß..."}]},
    {"filial":"TCA","responsavel":"Becher Barros","anomalias":21,"planos":0,"status":"Pendente","diretoria":"Comercial","detalhes":[{"dt":"2025-11-03","st":"Pendente","cat":"Diverg√™ncia de Estoque","desc":"NF DE TROCA COM FALTA DE PRODUTOS E FORA DO PADR√ÉO DE RECEBIMENTO (90 DIAS)...."}]},
    {"filial":"TCA","responsavel":"Jos√© Lima","anomalias":14,"planos":9,"status":"Atrasado","diretoria":"Logistica","detalhes":[{"dt":"2025-10-30","st":"Atrasado","cat":"Produto Vencido / FEFO","desc":"Produtos vencidos ainda presentes no pick Colaboradores j√° cientes do vencimento...."}]},
    {"filial":"TCA","responsavel":"Yasmin Silva","anomalias":1,"planos":0,"status":"Pendente","diretoria":"Comercial","detalhes":[{"dt":"2025-11-13","st":"Pendente","cat":"Devolu√ß√£o","desc":"No per√≠odo de 01/01/2025 a 31/10/2025, a unidade TCA apresentou R$ 1.731.923,40 em devolu√ß√µes, com p..."}]},
    {"filial":"TCG","responsavel":"Cleverson Kuba","anomalias":27,"planos":2,"status":"Pendente","diretoria":"Comercial","detalhes":[{"dt":"2025-10-30","st":"Conclu√≠do","cat":"Devolu√ß√£o","desc":"Notas de devolu√ß√£o sem pedido do cliente. Nfs: 14824 13628 13630 14262..."}]},
    {"filial":"TCG","responsavel":"Ian Jantsch","anomalias":2,"planos":0,"status":"Pendente","diretoria":"Logistica","detalhes":[{"dt":"2025-11-25","st":"Pendente","cat":"Diverg√™ncia de Estoque","desc":"Prezados, Refa√ßo um alerta importante referente ao procedimento de seguran√ßa nas docas do dep√≥sito. ..."}]},
    {"filial":"TCG","responsavel":"Jose Oscar","anomalias":11,"planos":0,"status":"Pendente","diretoria":"Logistica","detalhes":[{"dt":"2025-11-14","st":"Pendente","cat":"Diverg√™ncia de Estoque","desc":"Produtos misturados , aliment√≠cios com outros produtos,que nao fazem parte do mesmo segmento. Gerand..."}]},
    {"filial":"TCG","responsavel":"Leonardo Rosa","anomalias":1,"planos":1,"status":"Conclu√≠do","diretoria":"Comercial","detalhes":[{"dt":"2025-10-30","st":"Conclu√≠do","cat":"Devolu√ß√£o","desc":"Motivo da Devolu√ß√£o: 5127 conta como: atraso da logistica. conforme relato no e-mail 30/10 enviado p..."}]},
    {"filial":"TCG","responsavel":"Magno Souza","anomalias":4,"planos":5,"status":"Em Dia","diretoria":"Logistica","detalhes":[{"dt":"2025-10-31","st":"Em Dia","cat":"Avaria / Danos","desc":" Solicitante:LUANA FERREIRA  Justificativa: CONSUMO INDEVIDO E MANUSEIO INCORRETO INTERNO NA UNIDADE..."}]},
    {"filial":"TCV","responsavel":"Carlos Eduardo da Silva Camargo","anomalias":1,"planos":1,"status":"Atrasado","diretoria":"Comercial","detalhes":[{"dt":"2025-11-12","st":"Atrasado","cat":"Devolu√ß√£o","desc":"No per√≠odo de 01/01/2025 a 31/10/2025, a unidade TCV apresentou R$ 1.832.519,53 em devolu√ß√µes, sendo..."}]},
    {"filial":"TCV","responsavel":"Christian Miranda","anomalias":1,"planos":0,"status":"Conclu√≠do","diretoria":"Comercial","detalhes":[{"dt":"2025-11-10","st":"Conclu√≠do","cat":"Processo Operacional","desc":"teste- Validar o sistema SIG..."}]},
    {"filial":"TCV","responsavel":"Graciele Patricia da Silva","anomalias":2,"planos":0,"status":"Pendente","diretoria":"Financeiro","detalhes":[{"dt":"2025-11-25","st":"Pendente","cat":"Processo Operacional","desc":"Graciele, equipe de CPD realizou a baixa no sistema, pois a NF est√° anexa, por√©m n√£o atualizou o sta..."}]},
    {"filial":"TCV","responsavel":"Nei Lessak","anomalias":7,"planos":3,"status":"Pendente","diretoria":"Logistica","detalhes":[{"dt":"2025-11-11","st":"Em Dia","cat":"Avaria / Danos","desc":"Referente SOLICITACAO DE BAIXA DE ESTOQUE POR AVARIA - REG-33156-226, gentileza apresentar PLANO DE ..."}]},
    {"filial":"TPH","responsavel":"Alexandre Lima","anomalias":1,"planos":0,"status":"Pendente","diretoria":"Logistica","detalhes":[{"dt":"2025-11-25","st":"Pendente","cat":"Avaria / Danos","desc":"Avarias identificadas durante a separa√ß√£o, precisa de uma medida corretiva para evit√°-las ..."}]},
    {"filial":"TPH","responsavel":"Gerusa Ribeiro","anomalias":2,"planos":4,"status":"Atrasado","diretoria":"Financeiro","detalhes":[{"dt":"2025-11-01","st":"Atrasado","cat":"Processo Operacional","desc":"Temos 3 boletos em aberto da Vancar, vencido no dia 30/10 e ainda n√£o foi enviado para pagamento. ..."}]},
    {"filial":"TPH","responsavel":"Laudinil Souza Penteado","anomalias":1,"planos":0,"status":"Pendente","diretoria":"Comercial","detalhes":[{"dt":"2025-11-13","st":"Pendente","cat":"Devolu√ß√£o","desc":"No per√≠odo de 01/01/2025 a 31/10/2025, a unidade TPH apresentou R$ 4.071.314,62 em devolu√ß√µes, com p..."}]},
    {"filial":"TPH","responsavel":"Luiz Silva","anomalias":5,"planos":3,"status":"Pendente","diretoria":"Logistica","detalhes":[{"dt":"2025-10-28","st":"Conclu√≠do","cat":"Pend√™ncia Financeira / Fiscal","desc":"Em 28/10/2025 tiveram 06 notas da Qu√≠mica Amparo que foram informadas sem estarem inclu√≠das no CAP, ..."}]},
    {"filial":"TPH","responsavel":"Magno Souza","anomalias":1,"planos":1,"status":"Em Dia","diretoria":"Logistica","detalhes":[{"dt":"2025-11-13","st":"Em Dia","cat":"Devolu√ß√£o","desc":"No per√≠odo de 01/01/2025 a 31/10/2025, a unidade TPH apresentou um total de R$ 3.829.517,77 em devol..."}]},
    {"filial":"TPH","responsavel":"Rodrigo Bertoni","anomalias":13,"planos":5,"status":"Pendente","diretoria":"Comercial","detalhes":[{"dt":"2025-10-29","st":"Conclu√≠do","cat":"Produto Vencido / FEFO","desc":"Produtos de FEFO vencidos dentro do CD. Falta de a√ß√£o comercial para venda ou transfer√™ncia antes do..."}]},
    {"filial":"TPH","responsavel":"Ronaldo Crispim","anomalias":11,"planos":0,"status":"Pendente","diretoria":"Logistica","detalhes":[{"dt":"2025-11-11","st":"Pendente","cat":"Diverg√™ncia de Estoque","desc":"Ajustes de estoque realizados sem justificativa clara no sistema WMS..."}]},
    {"filial":"TSJ","responsavel":"Aldirene TSJ","anomalias":1,"planos":0,"status":"Pendente","diretoria":"Financeiro","detalhes":[{"dt":"2025-11-25","st":"Pendente","cat":"Devolu√ß√£o","desc":"Constata√ß√£o de ANOMALIAS no CAR da Unidade de TSJ, para conhecimento e elabora√ß√£o de plano de a√ß√£o q..."}]},
    {"filial":"TSJ","responsavel":"Ana Cristina","anomalias":1,"planos":3,"status":"Em Dia","diretoria":"Comercial","detalhes":[{"dt":"2025-11-13","st":"Em Dia","cat":"Pend√™ncia Financeira / Fiscal","desc":"Inadimplencia de cliente que tinha restri√ß√£o de compra 1 - Por que?  R.: Foi liberado a venda, pois ..."}]},
    {"filial":"TSJ","responsavel":"Carlos Saldanha","anomalias":7,"planos":0,"status":"Pendente","diretoria":"Comercial","detalhes":[{"dt":"2025-10-30","st":"Pendente","cat":"Produto Vencido / FEFO","desc":"Nota de Troca com Produto Fora do Prazo..."}]},
    {"filial":"TSJ","responsavel":"Cristiano Rodrigues","anomalias":1,"planos":0,"status":"Pendente","diretoria":"Comercial","detalhes":[{"dt":"2025-11-12","st":"Pendente","cat":"Devolu√ß√£o","desc":"No per√≠odo de 01/01/2025 a 31/10/2025, a unidade TSJ apresentou R$ 511.458,56 em devolu√ß√µes, sendo a..."}]},
    {"filial":"TSJ","responsavel":"Fabricio Ribeiro","anomalias":5,"planos":6,"status":"Pendente","diretoria":"Logistica","detalhes":[{"dt":"2025-11-10","st":"Conclu√≠do","cat":"Processo Operacional","desc":"Sensor de presen√ßa do corredor 3 disparando aleatoriamente..."}]}
];

// =================================================================
        // L√ìGICA DE ACESSO
        // =================================================================
        
        const CREDENCIAIS = {
            'admin': {pass:'admin123', view:'TODOS', name:'Administrador'},
            'ademir': {pass:'log123', view:'Logistica', name:'Ademir Lobato'},
            'saulo': {pass:'com123', view:'Comercial', name:'Saulo'},
            'ana': {pass:'rh123', view:'Gente', name:'Ana'},
            'fagnes': {pass:'fin123', view:'Financeiro', name:'Fagnes'},
            'luis': {pass:'prev123', view:'Prevencao', name:'Lu√≠s'}
        };

        let usuarioLogado = null;
        let ordenacao = { col: 'anomalias', dir: 'desc' };

        // --- FUN√á√ÉO INTELIGENTE DE CATEGORIZA√á√ÉO ---
        function classificarMotivo(desc) {
            let d = desc.toLowerCase();
            if (d.includes('queda') || d.includes('risco') || d.includes('strech') || d.includes('seguran√ßa') || d.includes('doca')) return 'Risco de Seguran√ßa / Queda';
            if (d.includes('roedor') || d.includes('praga') || d.includes('sujeira') || d.includes('limpeza') || d.includes('higiene')) return 'Controle de Pragas / Higiene';
            if (d.includes('diverg') || d.includes('falta') || d.includes('sobra') || d.includes('contagem') || d.includes('invent√°rio') || d.includes('estoque')) return 'Diverg√™ncia de Estoque';
            if (d.includes('venc') || d.includes('fefo') || d.includes('validade') || d.includes('prazo')) return 'Produto Vencido / FEFO';
            if (d.includes('avaria') || d.includes('quebra') || d.includes('danificado') || d.includes('derretido') || d.includes('consumo')) return 'Avaria / Danos';
            if (d.includes('fiscal') || d.includes('boleto') || d.includes('pagamento') || d.includes('t√≠tulo') || d.includes('cap') || d.includes('car')) return 'Pend√™ncia Financeira / Fiscal';
            if (d.includes('devol') || d.includes('troca') || d.includes('recus') || d.includes('retorno')) {
                if (d.includes('nf')) return 'Diverg√™ncia em NF de Troca';
                return 'Devolu√ß√£o de Cliente';
            }
            if (d.includes('nota') || d.includes('nf')) return 'Pend√™ncia de Nota Fiscal';
            return 'Processo Operacional';
        }

        function handleEnter(e) { if(e.key==='Enter') fazerLogin(); }

        function fazerLogin() {
            const u = document.getElementById('user').value.toLowerCase().trim();
            const p = document.getElementById('pass').value;
            if(CREDENCIAIS[u] && CREDENCIAIS[u].pass === p) {
                acessar(CREDENCIAIS[u]);
            } else {
                document.getElementById('errorMsg').style.display='block';
            }
        }

        function acessar(user) {
            usuarioLogado = user;
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('dashboardContainer').style.display = 'block';
            document.getElementById('userBadge').innerText = user.name;

            const selDir = document.getElementById('filtroDiretoria');
            selDir.innerHTML = `<option value="TODOS">-- Vis√£o Geral --</option><option value="Logistica">Log√≠stica</option><option value="Comercial">Comercial</option><option value="Gente">Gente e Gest√£o</option><option value="Financeiro">Financeiro</option><option value="Prevencao">Preven√ß√£o</option>`;
            selDir.value = user.view;
            
            if(user.view !== 'TODOS') {
                selDir.disabled = true; 
                selDir.style.background = '#eee';
            }
            renderizarDashboard();
        }

        function logout() { location.reload(); }
        function alterarFiltroDiretoria(val) { usuarioLogado.view = val; renderizarDashboard(); }

        function renderizarDashboard() {
            let dados;
            if (usuarioLogado.view === 'TODOS') dados = [...dadosBanco];
            else dados = dadosBanco.filter(d => d.diretoria === usuarioLogado.view);

            dados.sort((a,b) => {
                let vA = a[ordenacao.col], vB = b[ordenacao.col];
                if(typeof vA === 'string') return ordenacao.dir==='asc' ? vA.localeCompare(vB) : vB.localeCompare(vA);
                return ordenacao.dir==='asc' ? vA - vB : vB - vA;
            });

            let total=0, pend=0, atrasado=0, conc=0;
            dados.forEach(d => {
                total += d.anomalias;
                if(d.status==='Pendente') pend+=d.anomalias;
                else if(d.status==='Atrasado') atrasado+=d.anomalias;
                else conc+=d.anomalias;
            });
            document.getElementById('kpiTotal').innerText = total;
            document.getElementById('kpiPendente').innerText = pend;
            document.getElementById('kpiAtrasado').innerText = atrasado;
            document.getElementById('kpiConcluido').innerText = conc;

            const tbody = document.getElementById('tabelaCorpo');
            tbody.innerHTML = '';
            dados.forEach(d => {
                let bg = d.status==='Em Dia'?'bg-concluido':(d.status==='Atrasado'?'bg-atrasado':(d.status==='Conclu√≠do'?'bg-concluido':'bg-pendente'));
                let jsonItem = JSON.stringify(d).replace(/'/g, "&#39;");
                
                let tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><strong>${d.filial}</strong></td>
                    <td><a class="link-nome" onclick='prepararModal(${jsonItem})'>${d.responsavel}</a></td>
                    <td style="text-align:center;">${d.anomalias}</td>
                    <td style="text-align:center;">${d.planos}</td>
                    <td style="text-align:center;"><span class="badge ${bg}">${d.status}</span></td>
                    <td><button onclick='prepararModal(${jsonItem})' style="cursor:pointer; border:1px solid #ccc; background:#fff; border-radius:4px;">üîç Ver</button></td>
                `;
                tbody.appendChild(tr);
            });

            renderizarGraficos(dados);
        }

        function renderizarGraficos(dados) {
            let statusMap = {'Pendente':0, 'Atrasado':0, 'Conclu√≠do':0};
            let motivosMap = {};

            dados.forEach(d => {
                let s = (d.status==='Em Dia' || d.status==='Conclu√≠do') ? 'Conclu√≠do' : d.status;
                statusMap[s] += d.anomalias;

                if(d.detalhes){
                    d.detalhes.forEach(det => {
                        let m = classificarMotivo(det.desc);
                        motivosMap[m] = (motivosMap[m] || 0) + 1;
                    });
                }
            });

            let topMotivos = Object.entries(motivosMap).sort((a,b) => b[1] - a[1]).slice(0, 5);
            let topOfensores = [...dados].sort((a,b) => b.anomalias - a.anomalias).slice(0, 5);

            // --- Gr√°fico 1: Status ---
            let ctxS = document.getElementById('chartStatus').getContext('2d');
            if(window.chartS instanceof Chart) window.chartS.destroy();
            window.chartS = new Chart(ctxS, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(statusMap),
                    datasets: [{ data: Object.values(statusMap), backgroundColor: ['#dc3545','#fd7e14','#28a745'] }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { title: {display:true, text:'Status Geral'} } }
            });

            // --- Gr√°fico 2: Respons√°veis (CORRIGIDO: Mostra Nome Completo) ---
            let ctxR = document.getElementById('chartResponsavel').getContext('2d');
            if(window.chartR instanceof Chart) window.chartR.destroy();
            window.chartR = new Chart(ctxR, {
                type: 'bar',
                data: {
                    // AQUI FOI FEITA A ALTERA√á√ÉO: usamos d.responsavel direto, sem split
                    labels: topOfensores.map(d => d.responsavel), 
                    datasets: [{ 
                        label: 'Qtd', 
                        data: topOfensores.map(d => d.anomalias), 
                        backgroundColor: '#0056b3' 
                    }]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    plugins: { legend: {display:false}, title: {display:true, text:'Top 5 Ofensores'} } 
                }
            });

            // --- Gr√°fico 3: Motivos ---
            let canvasM = document.getElementById('chartMotivos');
            if (canvasM) {
                let ctxM = canvasM.getContext('2d');
                if(window.chartM instanceof Chart) window.chartM.destroy();
                window.chartM = new Chart(ctxM, {
                    type: 'bar',
                    data: {
                        labels: topMotivos.map(m => m[0]),
                        datasets: [{
                            label: 'Ocorr√™ncias',
                            data: topMotivos.map(m => m[1]),
                            backgroundColor: '#17a2b8',
                            borderRadius: 4
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: {display:false}, title: {display:true, text:'Top 5 Motivos (Causa Raiz)'} }
                    }
                });
            }
        }

        function ordenar(col) { ordenacao.dir = (ordenacao.col === col && ordenacao.dir === 'desc') ? 'asc' : 'desc'; ordenacao.col = col; renderizarDashboard(); }
        
        function prepararModal(item) { abrirDetalhes(item); }

        function abrirDetalhes(item) {
            document.getElementById('modalTitulo').innerText = item.responsavel;
            document.getElementById('modalSubtitulo').innerText = `${item.filial} | ${item.diretoria}`;
            const tbody = document.getElementById('modalCorpo');
            tbody.innerHTML = '';
            
            item.detalhes.forEach(det => {
                let dt = det.dt || det.data;
                let st = det.st || det.status;
                let motivoInteligente = classificarMotivo(det.desc);
                let badgeClass = st==='Pendente'?'bg-pendente':(st==='Conclu√≠do'?'bg-concluido':'bg-atrasado');
                
                let tr = `<tr>
                    <td>${dt}</td>
                    <td><span class="badge ${badgeClass}">${st}</span></td>
                    <td><span class="cat-tag">${motivoInteligente}</span></td>
                    <td style="color:#666; font-size:12px;">${det.desc}</td>
                </tr>`;
                tbody.innerHTML += tr;
            });
            document.getElementById('detalhesModal').style.display = 'block';
        }

        function fecharModal() { document.getElementById('detalhesModal').style.display = 'none'; }
        window.onclick = function(e) { if(e.target == document.getElementById('detalhesModal')) fecharModal(); }

</script>
</body>
</html>
